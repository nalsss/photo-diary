<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Photo Uploader</title>
<link rel="stylesheet" href="/public/styles.css" />
</head>
<body>
<main class="wrap">
<h1>Upload a Photo</h1>


<form id="upload-form">
<label class="block">
<span>Photo (JPG/PNG/HEIC, ≤ 15 MB)</span>
<input type="file" name="photo" id="photo" accept="image/*" required />
</label>


<label class="block">
<span>Caption (optional)</span>
<textarea name="caption" id="caption" rows="3" placeholder="Say something about this photo…"></textarea>
</label>


<label class="block">
<span>Admin Token</span>
<input type="password" id="token" placeholder="Paste your ADMIN_TOKEN" required />
</label>


<button type="submit">Upload</button>
</form>


<section id="result" class="mt"></section>
</main>


<script>
const form = document.getElementById('upload-form');
const result = document.getElementById('result');


form.addEventListener('submit', async (e) => {
e.preventDefault();
result.textContent = 'Uploading…';


const file = document.getElementById('photo').files[0];
const caption = document.getElementById('caption').value || '';
const token = document.getElementById('token').value.trim();


const fd = new FormData();
fd.append('photo', file);
fd.append('caption', caption);


try {
const res = await fetch('/api/upload', {
method: 'POST',
headers: { 'Authorization': `Bearer ${token}` },
body: fd
});
const data = await res.json();
if (!res.ok) throw new Error(data.error || 'Upload failed');


result.innerHTML = `
<p>✅ Posted!</p>
<figure>
<img src="${data.post.image.webUrl}" alt="preview" style="max-width:100%;height:auto" />
${data.post.caption ? `<figcaption>${data.post.caption}</figcaption>` : ''}
</figure>
`;
form.reset();
} catch (err) {
result.textContent = '❌ ' + err.message;
}
});
</script>
</body>
</html>